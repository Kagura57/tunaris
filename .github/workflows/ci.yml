name: ci

on:
  push:
  pull_request:

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  validate:
    runs-on: ubuntu-latest
    timeout-minutes: 25
    steps:
      - uses: actions/checkout@v4
      - uses: oven-sh/setup-bun@v2
        with:
          bun-version: "1.3.9"
      - name: Install dependencies
        run: bun install --frozen-lockfile
      - name: Lint
        run: bun run lint
      - name: Unit and integration tests
        env:
          DATABASE_URL: " "
          REDIS_URL: " "
          YOUTUBE_API_KEY: " "
          YOUTUBE_API_KEYS: " "
          YOUTUBE_INVIDIOUS_INSTANCES: " "
          YTMUSIC_SEARCH_URL: " "
        run: bun test apps/api/tests packages/shared/src apps/web/src/routes --timeout 20000
      - name: Build web app
        run: bun run --cwd apps/web build
      - name: Playwright test discovery
        run: bun x playwright test --list --pass-with-no-tests
